{% extends 'community_app/base.html' %}


{% block title %}{{ profile_user.username }}'s Profile - HealthConnect{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Profile Header -->
    <div class="card mb-6">
        <div class="flex items-start gap-6">
            <div class="w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center">
                {% if profile.profile_picture %}
                    <img src="{{ profile.profile_picture.url }}"
                         alt="{{ profile_user.username }}"
                         class="w-full h-full rounded-full object-cover">
                {% else %}
                    <i class="fas fa-user text-3xl text-gray-400"></i>
                {% endif %}
            </div>
            <div class="flex-1">
                <h1 class="text-2xl font-bold">{{ profile_user.username }}</h1>
                <p class="text-muted mb-4">{{ profile_user.email }}</p>

                {% if profile.bio %}
                    <p class="mb-4">{{ profile.bio }}</p>
                {% endif %}

                {% if profile.health_interest %}
                    <p class="mb-2">
                        <strong>Health Interests:</strong> {{ profile.health_interest }}
                    </p>
                {% endif %}

                {% if profile.expertise %}
                    <p>
                        <strong>Expertise:</strong> {{ profile.expertise }}
                    </p>
                {% endif %}

                {% if user == profile_user %}
                    <button onclick="toggleEditForm()" class="btn btn-primary mt-4">
                        <i class="fas fa-edit"></i> Edit Profile
                    </button>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Edit Profile Form (hidden by default) -->
    {% if user == profile_user %}
        <form id="edit-profile-form" method="POST" enctype="multipart/form-data"
              style="display: none;" class="card mb-6">
            {% csrf_token %}
            <h3 class="mb-4">Edit Profile</h3>
            {% for field in form %}
                <div class="form-group">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    {{ field }}
                    {% if field.errors %}
                        <div class="text-red-600 text-sm">{{ field.errors }}</div>
                    {% endif %}
                </div>
            {% endfor %}
            <div class="flex gap-2">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <button type="button" onclick="toggleEditForm()" class="btn">Cancel</button>
            </div>
        </form>
    {% endif %}

    <!-- Tabs -->
    <div class="flex border-b mb-6">
        <button id="journeys-tab" onclick="showTab('journeys')"
                class="px-4 py-2 font-medium border-b-2 border-primary">
            Health Journey
        </button>
        <button id="questions-tab" onclick="showTab('questions')"
                class="px-4 py-2 font-medium text-muted">
            My Questions
        </button>
        <button id="answers-tab" onclick="showTab('answers')"
                class="px-4 py-2 font-medium text-muted">
            My Answers
        </button>
    </div>

    <!-- Journeys Tab -->
    <div id="journeys-content">
        <div class="flex justify-between items-center mb-4">
            <h2>Health Journey</h2>
            {% if user == profile_user %}
                <a href="{% url 'add_journey' %}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Entry
                </a>
            {% endif %}
        </div>

        {% if journeys %}
            <div class="space-y-6">
                {% for journey in journeys %}
                    <div class="card">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h3 class="font-bold text-lg">{{ journey.title }}</h3>
                                <p class="text-sm text-muted">{{ journey.date|date:"F j, Y" }}</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <h4 class="font-medium mb-2">Symptoms</h4>
                                <p class="text-muted">{{ journey.symptom|linebreaks }}</p>
                            </div>

                            {% if journey.doctor %}
                                <div>
                                    <h4 class="font-medium mb-2">Doctor Consulted</h4>
                                    <p class="text-muted">{{ journey.doctor }}</p>
                                </div>
                            {% endif %}

                            {% if journey.test %}
                                <div>
                                    <h4 class="font-medium mb-2">Tests Done</h4>
                                    <p class="text-muted">{{ journey.test|linebreaks }}</p>
                                </div>
                            {% endif %}

                            {% if journey.treatment %}
                                <div>
                                    <h4 class="font-medium mb-2">Treatment</h4>
                                    <p class="text-muted">{{ journey.treatment|linebreaks }}</p>
                                </div>
                            {% endif %}
                        </div>

                        {% if journey.notes %}
                            <div>
                                <h4 class="font-medium mb-2">Notes</h4>
                                <p class="text-muted">{{ journey.notes|linebreaks }}</p>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="card text-center">
                <p class="text-muted">No journey entries yet.</p>
            </div>
        {% endif %}
    </div>

    <!-- Questions Tab -->
    <div id="questions-content" style="display: none;">
        <h2 class="mb-4">My Questions</h2>
        {% if questions %}
            {% for question in questions %}
                <div class="card mb-3">
                    <h3>
                        <a href="{% url 'question_detail' question.id %}">
                            {{ question.title }}
                        </a>
                    </h3>
                    <p class="text-muted text-sm mb-2">
                        {{ question.created_at|date:"M d, Y" }}
                    </p>
                    <p>{{ question.description|truncatewords:30 }}</p>
                </div>
            {% endfor %}
        {% else %}
            <div class="card">
                <p class="text-center text-muted">No questions asked yet.</p>
            </div>
        {% endif %}
    </div>

    <!-- Answers Tab -->
    <div id="answers-content" style="display: none;">
        <h2 class="mb-4">My Answers</h2>
        {% if answers %}
            {% for answer in answers %}
                <div class="card mb-3">
                    <h4 class="font-medium mb-2">
                        <a href="{% url 'question_detail' answer.question.id %}">
                            {{ answer.question.title }}
                        </a>
                    </h4>
                    <p class="text-muted text-sm mb-2">
                        Answered on {{ answer.created_at|date:"M d, Y" }}
                    </p>
                    <p>{{ answer.text|truncatewords:30 }}</p>
                </div>
            {% endfor %}
        {% else %}
            <div class="card">
                <p class="text-center text-muted">No answers given yet.</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
    function toggleEditForm() {
        const form = document.getElementById('edit-profile-form');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }

    function showTab(tabName) {
        // Hide all tabs
        document.getElementById('journeys-content').style.display = 'none';
        document.getElementById('questions-content').style.display = 'none';
        document.getElementById('answers-content').style.display = 'none';

        // Remove active class from all tab buttons
        document.getElementById('journeys-tab').classList.remove('border-b-2', 'border-primary');
        document.getElementById('questions-tab').classList.remove('border-b-2', 'border-primary');
        document.getElementById('answers-tab').classList.remove('border-b-2', 'border-primary');

        document.getElementById('journeys-tab').classList.add('text-muted');
        document.getElementById('questions-tab').classList.add('text-muted');
        document.getElementById('answers-tab').classList.add('text-muted');

        // Show selected tab
        document.getElementById(tabName + '-content').style.display = 'block';

        // Add active class to selected tab button
        document.getElementById(tabName + '-tab').classList.remove('text-muted');
        document.getElementById(tabName + '-tab').classList.add('border-b-2', 'border-primary');
    }
</script>
{% endblock %}